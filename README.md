# scheduler

> Scheduler for sammler.io.

[![David](https://img.shields.io/david/sammler/scheduler.svg)](https://github.com/sammler/scheduler)
[![Codecov](https://img.shields.io/codecov/c/github/sammler/scheduler.svg?logo=codecov)](https://codecov.io/gh/sammler/scheduler)
[![CircleCI](https://img.shields.io/circleci/project/github/sammler/scheduler/master.svg)](https://circleci.com/gh/sammler/scheduler)

---

## Purpose

Service to publish scheduled message to NATS.

Note: This service is not meant to be used in production, as it cannot horizontally scale. Instead the primary purpose is to use it in a non-production/development environment.

## Installation

### Docker Run

```
$ docker run sammlerio/scheduler
```

### Docker Compose

```yaml
version: '3.3'
services:

  nats-streaming:
    image: nats-streaming
    ports:
      - "4222:4222"
      - "4223:4223"
      - "8223:8223"
      - "8222:8222"
    volumes:
      - ./.datastore:/datastore
    command: [
      "-m", "8222",
      "--store", "FILE",
      "--dir", "datastore"
  
  scheduler:
    image: sammlerio/scheduler
    ports:
      - "3001:3001"
    environment:
      - NATS_URI=nats://nats-streaming:4222
      - LOAD_JOBS_FROM_FILE=true
      - JOB_FILES=file1.yml,file2.yml
```

## Configuration

Environment variables used by the service:

| Name                  | Description                                                             | Type          | Default Value           |
| ---                   | ---                                                                     | ---           | ---                     |
| `LOAD_JOBS_FROM_FILE` | Indicates whether some default jobs should be loaded from files or not. | boolean       | `false`                 |
| `JOB_FILES`           | Comma separated list of extra files to load from.                       | string        | ''                      |
| `NATS_URI`            | Resource location of NATS                                               | string        | `nats://localhost:4222` |
| `PORT`                | Port of the service.                                                    | string        | `3001`                  |

### Loading job seeds

- If `LOAD_JOBS_FROM_FILE` all `yml` files in `/opt/scheduler/src/config/job-seeds` will be loaded.
- (Not implemented yet) On top of that one can define additional files to be loaded by passing those in the env variable `JOB_FILES`.

### A job definition file

```yaml
jobs:
  - name: heartbeat       # The name of a job
    enabled: true         # Whether this job is enabled or not
    strategy: cron        # Default strategy for this job, by default only `cron` for now.
    cron:                 # All the cron related settings.
      def: "* * * * * *"  # Definition of the cron job.
    nats:
      subject: foo        # Nats' subject.
    data:                 # Various payload settings, passed over to nats.
      setting1: foo           
      setting2: bar
      setting3: baz
    
```

## Developing

### Required services (dependencies)

- `make up-deps` - Start required services.
- `make up-deps-i` - Start required services (interactive mode).
- `make down-deps` - Stop required services.
- `clean-deps` - Step required services + clean-up nats storage.

The commands above use the docker file `docker-compose.deps.yml`.

## About

### Author
**Stefan Walther**

* [twitter](http://twitter.com/waltherstefan)  
* [github.com/stefanwalther](http://github.com/stefanwalther) 
* [LinkedIn](https://www.linkedin.com/in/stefanwalther/) 
* [stefanwalther.io](https://stefanwalther.io)

### Contributing
Pull requests and stars are always welcome. For bugs and feature requests, [please create an issue](https://github.com/sammlerio/scheduler/issues). The process for contributing is outlined below:

1. Create a fork of the project
2. Work on whatever bug or feature you wish
3. Create a pull request (PR)

I cannot guarantee that I will merge all PRs but I will evaluate them all.

### License
MIT

***

_This file was generated by [verb-generate-readme](https://github.com/verbose/verb-generate-readme), v0.6.0, on October 06, 2018._

